{"ast":null,"code":"var _jsxFileName = \"/home/max/Documentos/microsys/src/contexts/auth.js\",\n    _s = $RefreshSig$();\n\nimport React, { useState, createContext, useEffect } from 'react';\nimport api from '../services/api';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nexport const AuthContext = /*#__PURE__*/createContext({});\n\nfunction AuthProvider({\n  children\n}) {\n  _s();\n\n  const [user, setUser] = useState(null);\n  const [loading, setLoading] = useState(true);\n  const [dataListUsers, setDataListUsers] = useState([]);\n  const [errorMessage, setErrorMessage] = useState(null);\n  const [token, setToken] = useState('');\n  const [master, setMaster] = useState(false);\n\n  async function auth(email, password) {\n    setLoading(true);\n\n    try {\n      const credentials = {\n        email: email,\n        password: password\n      };\n      const application = {\n        applicationId: \"82d2ddd0-593c-11ec-aac1-d1c56c82bf33\" || \"82d10910-593c-11ec-aac1-d1c56c82bf33\"\n      };\n      delete api.defaults.headers.common.Authorization;\n      const response = await api.post('/token/guest', application).catch(err => {\n        console.log(err.response);\n      });\n      const tokenGuest = 'Bearer ' + response.data.accessToken;\n      api.defaults.headers.common.Authorization = tokenGuest;\n      const responseUser = await api.post('/token/login', credentials);\n      const tokenLogin = responseUser.data.accessToken;\n      setToken(tokenLogin);\n      await localStorage.setItem('token', tokenLogin);\n      api.defaults.headers.common.Authorization = 'Bearer ' + tokenLogin;\n      const user = responseUser.data;\n      storage(user);\n      setUser(user);\n      setLoading(false);\n\n      if (user && user.master === true) {\n        setMaster(true);\n      } else if (user && user.master === false) {\n        setMaster(true);\n      } else {\n        setLoading(false);\n        setErrorMessage('Usuário não permitido');\n      }\n    } catch (err) {\n      console.log(\"OUTRO ERRO: \" + err);\n      setLoading(false);\n    }\n  }\n\n  function storage(data) {\n    localStorage.setItem('@user', JSON.stringify(data));\n  } //Logout do usuario\n\n\n  async function signOut() {\n    setUser(null);\n    setMaster(false);\n    localStorage.removeItem('@user');\n    setUser(null);\n  }\n\n  useEffect(() => {\n    async function loadStorage() {\n      const storageUser = await localStorage.getItem('@user');\n      const token = await localStorage.getItem('token');\n\n      if (storageUser && token) {\n        const storage = JSON.parse(storageUser);\n        const tokenUser = token;\n        setToken(tokenUser);\n        setUser(storage);\n        setLoading(false);\n        setMaster(storage.master);\n      }\n\n      setLoading(false);\n      return;\n    }\n\n    loadStorage();\n  }, []);\n  return /*#__PURE__*/_jsxDEV(AuthContext.Provider, {\n    value: {\n      signed: !!user,\n      user,\n      loading,\n      setLoading,\n      auth,\n      master,\n      signOut,\n      dataListUsers,\n      setDataListUsers,\n      token\n    },\n    children: children\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 100,\n    columnNumber: 9\n  }, this);\n}\n\n_s(AuthProvider, \"5XXzWsL4OAZlsoJeOtrKqnhLryc=\");\n\n_c = AuthProvider;\nexport default AuthProvider;\n\nvar _c;\n\n$RefreshReg$(_c, \"AuthProvider\");","map":{"version":3,"sources":["/home/max/Documentos/microsys/src/contexts/auth.js"],"names":["React","useState","createContext","useEffect","api","AuthContext","AuthProvider","children","user","setUser","loading","setLoading","dataListUsers","setDataListUsers","errorMessage","setErrorMessage","token","setToken","master","setMaster","auth","email","password","credentials","application","applicationId","defaults","headers","common","Authorization","response","post","catch","err","console","log","tokenGuest","data","accessToken","responseUser","tokenLogin","localStorage","setItem","storage","JSON","stringify","signOut","removeItem","loadStorage","storageUser","getItem","parse","tokenUser","signed"],"mappings":"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","sourcesContent":["import React, { useState, createContext, useEffect } from 'react';\nimport api from '../services/api';\n\nexport const AuthContext = createContext({});\n\nfunction AuthProvider({children}){\n    const [user, setUser] = useState(null);\n    const [loading, setLoading] = useState(true);\n    const [dataListUsers, setDataListUsers] = useState([]);\n    const [errorMessage, setErrorMessage] = useState(null);\n    const [token, setToken] = useState('')\n    const [master, setMaster] = useState(false);\n\n    async function auth(email, password){\n\n        setLoading(true);\n        try {\n            const credentials = {\n              email: email,\n              password: password,\n            }\n      \n            const application = {\n              applicationId: \"82d2ddd0-593c-11ec-aac1-d1c56c82bf33\" || \"82d10910-593c-11ec-aac1-d1c56c82bf33\"\n            }\n      \n            delete api.defaults.headers.common.Authorization;\n      \n            const response = await api.post('/token/guest', application)\n              .catch((err => {\n                console.log(err.response);\n              }))\n      \n            const tokenGuest = 'Bearer ' + response.data.accessToken;\n      \n            api.defaults.headers.common.Authorization = tokenGuest;\n      \n            const responseUser = await api.post('/token/login', credentials);\n      \n            const tokenLogin = responseUser.data.accessToken;\n            setToken(tokenLogin);\n            await localStorage.setItem('token', tokenLogin);\n            api.defaults.headers.common.Authorization = 'Bearer ' + tokenLogin;\n           const user = responseUser.data;\n           storage(user);\n           setUser(user);\n           setLoading(false);\n            if(user && user.master === true) {\n              setMaster(true);\n            }else if(user && user.master === false){\n              setMaster(true);\n            }else {\n              setLoading(false);\n              setErrorMessage('Usuário não permitido');\n            }\n          } catch (err) {\n            console.log(\"OUTRO ERRO: \" + err);\n            setLoading(false);\n          }\n    }\n\n    function storage(data){\n        localStorage.setItem('@user', JSON.stringify(data));\n    }\n\n      //Logout do usuario\n    async function signOut(){\n      setUser(null);\n      setMaster(false);\n      localStorage.removeItem('@user');\n      setUser(null);\n    }\n\n    useEffect(()=>{\n\n      async function loadStorage(){\n        const storageUser = await localStorage.getItem('@user');\n        const token = await localStorage.getItem('token');\n\n        if(storageUser && token){\n          const storage = JSON.parse(storageUser);\n          const tokenUser = token;\n          setToken(tokenUser);\n          setUser(storage);\n          setLoading(false);\n          setMaster(storage.master);\n\n        }\n        \n        setLoading(false);\n        return\n      }\n      \n      loadStorage();\n  \n    }, [])\n\n\n    return(\n        <AuthContext.Provider value={{ signed: !!user, user, \n        loading, setLoading, auth, master, signOut, dataListUsers, setDataListUsers, token }}>\n            {children}\n        </AuthContext.Provider>\n    )\n}\n\nexport default AuthProvider;"]},"metadata":{},"sourceType":"module"}