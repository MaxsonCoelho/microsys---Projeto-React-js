{"ast":null,"code":"import _regeneratorRuntime from\"/home/max/Documentos/microsys/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/home/max/Documentos/microsys/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"/home/max/Documentos/microsys/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React,{useState,createContext,useEffect}from'react';import api from'../services/api';import{jsx as _jsx}from\"react/jsx-runtime\";export var AuthContext=/*#__PURE__*/createContext({});function AuthProvider(_ref){var children=_ref.children;var _useState=useState(null),_useState2=_slicedToArray(_useState,2),user=_useState2[0],setUser=_useState2[1];var _useState3=useState(true),_useState4=_slicedToArray(_useState3,2),loading=_useState4[0],setLoading=_useState4[1];var _useState5=useState([]),_useState6=_slicedToArray(_useState5,2),dataListUsers=_useState6[0],setDataListUsers=_useState6[1];var _useState7=useState(null),_useState8=_slicedToArray(_useState7,2),errorMessage=_useState8[0],setErrorMessage=_useState8[1];var _useState9=useState(''),_useState10=_slicedToArray(_useState9,2),token=_useState10[0],setToken=_useState10[1];var _useState11=useState(false),_useState12=_slicedToArray(_useState11,2),master=_useState12[0],setMaster=_useState12[1];function auth(_x,_x2){return _auth.apply(this,arguments);}function _auth(){_auth=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(email,password){var credentials,application,response,tokenGuest,responseUser,tokenLogin,_user;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:setLoading(true);_context2.prev=1;credentials={email:email,password:password};application={applicationId:\"82d2ddd0-593c-11ec-aac1-d1c56c82bf33\"||\"82d10910-593c-11ec-aac1-d1c56c82bf33\"};delete api.defaults.headers.common.Authorization;_context2.next=7;return api.post('/token/guest',application).catch(function(err){console.log(err.response);});case 7:response=_context2.sent;tokenGuest='Bearer '+response.data.accessToken;api.defaults.headers.common.Authorization=tokenGuest;_context2.next=12;return api.post('/token/login',credentials);case 12:responseUser=_context2.sent;tokenLogin=responseUser.data.accessToken;setToken(tokenLogin);_context2.next=17;return localStorage.setItem('token',tokenLogin);case 17:api.defaults.headers.common.Authorization='Bearer '+tokenLogin;_user=responseUser.data;storage(_user);setUser(_user);setLoading(false);if(_user&&_user.master===true){setMaster(true);}else if(_user&&_user.master===false){setMaster(true);}else{setLoading(false);setErrorMessage('Usuário não permitido');}_context2.next=29;break;case 25:_context2.prev=25;_context2.t0=_context2[\"catch\"](1);console.log(\"OUTRO ERRO: \"+_context2.t0);setLoading(false);case 29:case\"end\":return _context2.stop();}}},_callee2,null,[[1,25]]);}));return _auth.apply(this,arguments);}function storage(data){localStorage.setItem('@user',JSON.stringify(data));}//Logout do usuario\nfunction signOut(){return _signOut.apply(this,arguments);}function _signOut(){_signOut=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee3(){return _regeneratorRuntime.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:setUser(null);setMaster(false);localStorage.removeItem('@user');setUser(null);case 4:case\"end\":return _context3.stop();}}},_callee3);}));return _signOut.apply(this,arguments);}useEffect(function(){function loadStorage(){return _loadStorage.apply(this,arguments);}function _loadStorage(){_loadStorage=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var storageUser,token,_storage,tokenUser;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.next=2;return localStorage.getItem('@user');case 2:storageUser=_context.sent;_context.next=5;return localStorage.getItem('token');case 5:token=_context.sent;if(storageUser&&token){_storage=JSON.parse(storageUser);tokenUser=token;setToken(tokenUser);setUser(_storage);setLoading(false);setMaster(_storage.master);}setLoading(false);return _context.abrupt(\"return\");case 9:case\"end\":return _context.stop();}}},_callee);}));return _loadStorage.apply(this,arguments);}loadStorage();},[]);return/*#__PURE__*/_jsx(AuthContext.Provider,{value:{signed:!!user,user:user,loading:loading,setLoading:setLoading,auth:auth,master:master,signOut:signOut,dataListUsers:dataListUsers,setDataListUsers:setDataListUsers,token:token},children:children});}export default AuthProvider;","map":{"version":3,"sources":["/home/max/Documentos/microsys/src/contexts/auth.js"],"names":["React","useState","createContext","useEffect","api","AuthContext","AuthProvider","children","user","setUser","loading","setLoading","dataListUsers","setDataListUsers","errorMessage","setErrorMessage","token","setToken","master","setMaster","auth","email","password","credentials","application","applicationId","defaults","headers","common","Authorization","post","catch","err","console","log","response","tokenGuest","data","accessToken","responseUser","tokenLogin","localStorage","setItem","storage","JSON","stringify","signOut","removeItem","loadStorage","getItem","storageUser","parse","tokenUser","signed"],"mappings":"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","sourcesContent":["import React, { useState, createContext, useEffect } from 'react';\nimport api from '../services/api';\n\nexport const AuthContext = createContext({});\n\nfunction AuthProvider({children}){\n    const [user, setUser] = useState(null);\n    const [loading, setLoading] = useState(true);\n    const [dataListUsers, setDataListUsers] = useState([]);\n    const [errorMessage, setErrorMessage] = useState(null);\n    const [token, setToken] = useState('')\n    const [master, setMaster] = useState(false);\n\n    async function auth(email, password){\n\n        setLoading(true);\n        try {\n            const credentials = {\n              email: email,\n              password: password,\n            }\n      \n            const application = {\n              applicationId: \"82d2ddd0-593c-11ec-aac1-d1c56c82bf33\" || \"82d10910-593c-11ec-aac1-d1c56c82bf33\"\n            }\n      \n            delete api.defaults.headers.common.Authorization;\n      \n            const response = await api.post('/token/guest', application)\n              .catch((err => {\n                console.log(err.response);\n              }))\n      \n            const tokenGuest = 'Bearer ' + response.data.accessToken;\n      \n            api.defaults.headers.common.Authorization = tokenGuest;\n      \n            const responseUser = await api.post('/token/login', credentials);\n      \n            const tokenLogin = responseUser.data.accessToken;\n            setToken(tokenLogin);\n            await localStorage.setItem('token', tokenLogin);\n            api.defaults.headers.common.Authorization = 'Bearer ' + tokenLogin;\n           const user = responseUser.data;\n           storage(user);\n           setUser(user);\n           setLoading(false);\n            if(user && user.master === true) {\n              setMaster(true);\n            }else if(user && user.master === false){\n              setMaster(true);\n            }else {\n              setLoading(false);\n              setErrorMessage('Usuário não permitido');\n            }\n          } catch (err) {\n            console.log(\"OUTRO ERRO: \" + err);\n            setLoading(false);\n          }\n    }\n\n    function storage(data){\n        localStorage.setItem('@user', JSON.stringify(data));\n    }\n\n      //Logout do usuario\n    async function signOut(){\n      setUser(null);\n      setMaster(false);\n      localStorage.removeItem('@user');\n      setUser(null);\n    }\n\n    useEffect(()=>{\n\n      async function loadStorage(){\n        const storageUser = await localStorage.getItem('@user');\n        const token = await localStorage.getItem('token');\n\n        if(storageUser && token){\n          const storage = JSON.parse(storageUser);\n          const tokenUser = token;\n          setToken(tokenUser);\n          setUser(storage);\n          setLoading(false);\n          setMaster(storage.master);\n\n        }\n        \n        setLoading(false);\n        return\n      }\n      \n      loadStorage();\n  \n    }, [])\n\n\n    return(\n        <AuthContext.Provider value={{ signed: !!user, user, \n        loading, setLoading, auth, master, signOut, dataListUsers, setDataListUsers, token }}>\n            {children}\n        </AuthContext.Provider>\n    )\n}\n\nexport default AuthProvider;"]},"metadata":{},"sourceType":"module"}